<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.kcs.rest.dao.SummaryDao" >


    <select id="findAllSummary" resultType="com.kcs.rest.pojo.Summary">
        select *
        from [Summary]
    </select>

    <select id="findGoodsIDByTime" resultType="com.kcs.rest.pojo.Goods" parameterType="java.lang.String">
        select GoodsID
        from [Summary]
        where Time like #{Time}+'%'
    </select>

    <select id="findSummaryByGoodsIDAndTime" resultType="com.kcs.rest.pojo.Summary">
        select *
        from [Summary]
        where GoodsID = #{GoodsID} and Time like #{Time}+'%'
    </select>

    <select id="findSummaryByGoodsIDAndTimeAfter" resultType="com.kcs.rest.pojo.Summary">
        select *
        from [Summary]
        where GoodsID = #{GoodsID} and Time >= #{Time}
    </select>

    <select id="findSummaryInTheLastGoodsDataByGoodsID" resultType="com.kcs.rest.pojo.Summary" parameterType="java.lang.Integer">
        select * from (SELECT * FROM Summary s1 WHERE not EXISTS
        (select GoodsID from Summary s2 WHERE s2.Time>s1.Time and s1.GoodsID = s2.GoodsID))s2
        where s2.GoodsID = #{GoodsID}
    </select>

    <update id="updateSummary" parameterType="com.kcs.rest.pojo.Summary" >
         update [Summary]
         <trim prefix="set" suffixOverrides=",">
             <if test="GoodsID != null">GoodsID = #{GoodsID},</if>
             <if test="PreAmount != null">PreAmount = #{PreAmount},</if>
             <if test="PrePrice != null">PrePrice = #{PrePrice},</if>
             <if test="PreTotal != null">PreTotal = #{PreTotal},</if>
             <if test="InAmount != null">InAmount = #{InAmount},</if>
             <if test="InPrice != null">InPrice = #{InPrice},</if>
             <if test="InTotal != null">InTotal = #{InTotal},</if>
             <if test="OutAmount != null">OutAmount = #{OutAmount},</if>
             <if test="OutPrice != null">OutPrice = #{OutPrice},</if>
             <if test="OutTotal != null">OutTotal = #{OutTotal},</if>
             <if test="ThisAmount != null">ThisAmount = #{ThisAmount},</if>
             <if test="ThisPrice != null">ThisPrice = #{ThisPrice},</if>
            <if test="ThisTotal != null">ThisTotal = #{ThisTotal},</if>
            <if test="Time != null">Time = #{Time},</if>
         </trim>
         where SummaryID =#{SummaryID}
    </update>
</mapper>